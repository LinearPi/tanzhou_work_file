<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="701"/>

<div>
<span><div><ul><li><span style="font-size: 10pt;">什么是redis</span></li><ul><li><span style="font-size: 13.3333px;">市面上一般两种数据库，一种是mysql、oricle之类的关系型数据，还就是键值数据库</span></li><li><span style="font-size: 13.3333px;">键值数据库的存储结构类似于一个字典</span></li><li>Redis是一个开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</li><li><span style="font-size: 10pt;">它通常被称为数据结构服务器，因为值（value）可以是 字符串(String), 哈希(Map), 列表(list), 集合(sets) 和 有序集合(sorted sets)等类型。</span></li><li>数据结构</li><ul><li>string（字符串）</li><li>list（双向链表）</li><li>dict（hash表）</li><li>zset（有序集合）</li><li>set（集合）</li></ul><li>相比如关系数据的优势</li><ul><li>它是键值数据库，本身数据结构查询就比关系数据库快</li><li>redis是基础内存的一个数据库，I/O影响的效率较小</li></ul></ul><li>安装</li><ul><li>我们的系统中已经自带，如想研究，请自行百度</li></ul><li>启停</li><ul><li>启动</li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>sudo service redis start</div></div></div><div><div><br/></div><ul><li>停止</li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>sudo service redis stop</div></div></div><div><br/></div><div><ul><li>重启</li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>sudo service redis restart</div></div></div><div><br/></div><div><ul><li><span style="font-size: 13.3333px;">客户端操作</span></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-size: 13.3333px;">redis-cli</span></div></div><div><br/></div><ul><li><span style="font-size: 10pt;">什么是缓存</span></li><ul><li><span style="font-size: 10pt;">缓存系统是为了解决数据库服务器和web服务器之间的瓶颈。如果一个网站的流量很大，这个瓶颈将会非常明显，每次数据库查询耗费的时间将会非常可观。对于更新速度不是很快的网站，我们可以用静态化来避免过多的数据库查询。对于更新速度以秒计的网站，静态化也不会太理想，可以用缓存系统来构建。如果只是单台服务器用作缓存，问题不会太复杂，如果有多台服务器用作缓存，就要考虑缓存服务器的负载均衡。</span></li></ul></ul></div><div><br/></div><div><ul><li><span style="font-size: 10pt;">在django中使用redis当作缓存</span></li><ul><li><span style="font-size: 13.3333px;">安装，django-redis是一个开源的python包</span></li><li><span style="font-size: 13.3333px;">django-redis文档地址：<a href="https://github.com/niwinz/django-redis" style="color: rgb(0, 0, 238); text-decoration: underline;">https://github.com/niwinz/django-redis</a></span></li></ul></ul><div><br/></div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>pip install django-redis==4.8.0</div></div><div><br/></div><div><ul><li><span style="font-size: 13.3333px;">在settings中配置如下</span></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">CACHES = {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    &quot;default&quot;: {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &quot;BACKEND&quot;: &quot;django_redis.cache.RedisCache&quot;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &quot;LOCATION&quot;: &quot;redis://127.0.0.1:6379&quot;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        &quot;OPTIONS&quot;: {</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">            &quot;CLIENT_CLASS&quot;: &quot;django_redis.client.DefaultClient&quot;,</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">    }</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">}</span></div></div><div><br/></div><div><div><br/></div><ul><li>使用页面缓存</li><ul><li>页面缓存使用的场景，一般都是变动较小的页面，比如Index，首页</li><li>页面缓存使用需要注意，因为可能影响你逻辑展示</li></ul></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">from django.views.decorators.cache import cache_page</span></div><div><font face="Monaco">...</font></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">url(r'^login/$', cache_page(60)(views.Login.as_view()), name=&quot;login&quot;),</span></div></div></div><div><br/></div><div><ul><li>访问缓存</li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">from django.core.cache import cache</span></div></div></div><div><div><br/></div><ul><li><span style="font-size: 10pt;">新建set(key, value, timeout), </span></li><ul><li><span style="font-size: 10pt;">key：键</span></li><li><span style="font-size: 10pt;">value： 值</span></li><li><span style="font-size: 10pt;">timeout： 超时时间， 是一个可选参数，默认为你配置的超时时间</span></li></ul></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">cache.set('my_key', 'hello, world!', 30)</span></div></div><div><div><br/></div><ul><li><span style="font-size: 10pt;">添加add</span><span style="font-size: 10pt;">(key, value, timeout)它使用与set()相同的参数，但如果指定的键已经存在，它不会尝试更新缓存</span></li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">cache.add('my_key', 'hello, world!')</span></div></div><div><br/></div><div><ul><li>设置多个值set_many ，请使用set_many()传递键值对的字典：</li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">cache.set_many({'a': 1, 'b': 2, 'c': 3})</span></div></div><div><br/></div><ul><li><span style="font-size: 13.3333px;">获取get(key)</span></li></ul></div><div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Fira Mono; font-size: 9pt; color: rgb(51, 51, 51);">cache.get('add_key')</span></div></div><div><br/></div><ul><li>获取与创建get_or_set(key, value, timeout)</li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">cache.get_or_set(&quot;test&quot;, &quot;2&quot;, 100)</span></div></div><div><br/></div><div><ul><li>删除delete(key)</li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">cache.delete('a')</span></div></div></div><div> </div><div><ul><li>批量删除 delete_many(keys) </li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">cache.delete_many(['a', 'b', 'c'])</span></div></div><div><br/></div><div><ul><li>清除所有clear， 该操作一定要慎重</li></ul></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">cache.clear()</span></div></div><div><br/></div><div><br/></div><div><ul><li><span style="font-size: 10pt;">在实际情况中使用缓存</span></li><ul><li><span style="font-size: 10pt;">使用页面缓存讲我们的首页静态化</span></li><li><span style="font-size: 10pt;">使用缓存获取对应主题内容</span></li></ul></ul></div><div><br/></div></span>
</div></body></html> 