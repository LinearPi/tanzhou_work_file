<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/306387 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="695"/>

<div>
<span><div><div><ul><li><font style="font-size: 16pt;"><font>什么是django表单:</font><br/></font></li><ul><li><font style="font-size: 16pt;">django中的表单不是html中的那个表单，这里是指django有一个组件名叫表单</font></li><li><font style="font-size: 16pt;">它可以通过配置去验证数据的合法性</font></li><li><font style="font-size: 16pt;">同样也可以通过配置生成HTML代码.</font></li></ul></ul></div><div><font style="font-size: 16pt;"><br/></font></div><div><ul><li><font style="font-size: 16pt;"><font>使用表单:</font><br/></font></li><ul><li><font style="font-size: 16pt;">创建一个`forms.py`的文件,放在指定的app当中,然后在里面写表单.</font></li><ul><li><font style="font-size: 16pt;">同样要记得在settings中添加至INSTALLED_APPS</font></li></ul><li><font style="font-size: 16pt;">表单是通过类实现的,继承自`forms.Form`,然后在里面定义要验证的字段.</font></li></ul></ul><font style="font-size: 16pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">from django.forms import Form</font></span></div></div><div><font style="font-size: 16pt;"><br/></font><ul><li><font style="font-size: 16pt;">在表单中,创建字段跟模型是一模一样的,但是没有`null=True`或者`blank=True`等这几种参数了,有的参数是`required=True/False`.</font></li></ul></div><div><ul><li><font style="font-size: 16pt;">表单生成HTML元素:</font></li></ul></div><div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font face="Monaco" style="font-size: 16pt;"># views.py</font></div><div><font face="Monaco" style="font-size: 16pt;">def<span>  get(self, request)</span></font></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">        return render(request,'regist_form.html',{'form':RegistForm()})</font></span></div></div><font style="font-size: 16pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;"># register.html</font></span></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">&lt;form action=&quot;&quot; method='POST'&gt;</font></span></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">        {%csrf_token%}</font></span></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">        {{form}}</font></span></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">        &lt;input type=&quot;submit&quot; vlaue='注册'&gt;</font></span></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">    &lt;/form&gt;</font></span></div></div><div><font style="font-size: 16pt;">   </font></div><div><font style="font-size: 16pt;">ps： 使用django的Form类生成的表单，不包含form和submit按钮两个标签，需要手动添加。</font></div><div><font style="font-size: 16pt;">ps :   这个模块用得比较少，这个功能确实很鸡肋，把前端该做的事情放到后台来实现，增加了代码的耦合性也增加了服务器的压力。在真正开发中，是讲究前后端代码分离的。</font></div><div><font style="font-size: 16pt;"><br/></font></div><div><ul><li><font style="font-size: 16pt;">不使用表单生成元素</font></li><ul><li><font style="font-size: 16pt;">写好对应的html元素，HTML表单元素的`name`必须和`django`中的表单的`name`保持一致,否则匹配不到.</font></li><li><font style="font-size: 16pt;">后台post方法调用</font></li></ul></ul><font style="font-size: 16pt;"><br/></font></div><div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 16pt;"><span style="font-family: Monaco; color: rgb(51, 51, 51);">form = RegistForm(request.POST)</span></font></div></div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font><ul><li><font style="font-size: 16pt;">使用`is_valid()`方法可以验证用户提交的数据是否合法, 这个方法会返回一个bool，合法返回`True`, 否则返回False</font></li></ul><font style="font-size: 16pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 16pt;"><span style="font-family: Monaco; color: rgb(51, 51, 51);">form.is_valid()</span></font></div></div><div><font style="font-size: 16pt;"><br/></font><ul><li><font style="font-size: 16pt;">`is_bound`属性:用来表示`form`是否绑定了数据,如果绑定了,则返回`True`,否则返回`False`.</font></li><li><font style="font-size: 16pt;">`cleaned_data`:这个是在`is_valid()`返回`True`的时候,保存用户提交上来的数据。</font></li><ul><li><font style="font-size: 16pt;">有的版本它是一个生成器类型，数据取一次后，就没有了 ，当你调用某个cleaned_data以后，当前form内的该数据就会被清除</font></li></ul></ul><font style="font-size: 16pt;"><br/><br/></font></div><div><ul><li><font style="font-size: 16pt;"><font>上传文件:</font><br/></font></li><ul><li><font style="font-size: 16pt;">在相应的<b>模型</b>里面定义`FileField`或者是`ImageField`类型的字段,并且设置好`upload_to`参数来指定上传的路径.<br/></font></li></ul></ul><font style="font-size: 16pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">    headshot = models.ImageField(u'头像', upload_to=&quot;upload/%Y/%m/%d&quot;)</font></span></div></div><div><font style="font-size: 16pt;"><br/></font><ul><li><font style="font-size: 16pt;">如果是使用ImageField，会需要安装一个依赖Pillow, Pillow是专门做图片处理的一个python包</font></li></ul><font style="font-size: 16pt;"><br/></font></div><div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">pip install Pillow</font></span></div></div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font><ul><li><font style="font-size: 16pt;">需要在`settings.py`文件中指定媒体路径`MEDIA_ROOT`.</font></li></ul><font style="font-size: 16pt;"><br/></font></div><div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">MEDIA_ROOT = &quot;media/&quot;</font></span></div></div><font style="font-size: 16pt;"><span> ps： 这里是媒体文件，在django中，这一块的内容是要跟静态文件分开处理的</span><br/></font></div><div><font style="font-size: 16pt;"><br/></font><ul><li><font style="font-size: 16pt;">文件上传需要在HTML代码中的form表单中添加`enctype=&quot;multipart/form-data&quot;`以及在views当中,使用`request.FILES`来接收文件.</font></li></ul><font style="font-size: 16pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">form = LoginUserForm(request.POST, request.FILES)</font></span></div></div><div><font style="font-size: 16pt;"><br/></font><ul><li><font style="font-size: 16pt;">文件只有在保存时才会处理，数据库保存的是文件的路径,不会保存文件本身.</font></li></ul><font style="font-size: 16pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">user = LoginUser(**form.clean())</font></span></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">user.save()</font></span></div></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><ul><li><font style="font-size: 16pt;">表单错误消息:</font></li><ul><li><font style="font-size: 16pt;">表单验证没有通过后，表单会产生一个`errors`属性，这个属性包括所有的验证错误信息。</font></li><li><font style="font-size: 16pt;">通过`form.errors`即可访问。</font></li><li><font style="font-size: 16pt;">通过`form.erros.属性名`访问对应的错误</font></li><li><font style="font-size: 16pt;">通过`form.errors.as_json()`可以将错误消息转换成json数据。</font></li><li><font style="font-size: 16pt;">自定义错误消息:在`Field`中添加一个`error_messages`的`dict`类型的参数,然后根据`属性名`设置对应的`message`,例如以下代码:</font></li><li><font style="font-size: 16pt;">必须要执行完is_valid函数，否则errors是不会包含错误</font></li></ul></ul><div><font style="font-size: 16pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco;"><font style="font-size: 16pt;">    password = forms.CharField(max_length=10,error_messages={'required':u'密码不能少'})</font></span></div></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><ul><li><font style="font-size: 16pt;">表单自定义错误消息:<br/></font></li><ul><li><font style="font-size: 16pt;">在表单中，重写方法`clean_field`（field是一个属性名），可以自定义针对某一个`field`的验证机制，如果出现错误</font></li></ul></ul></div><div><ul><li><font style="font-size: 16pt;">如果某个`field`出现验证错误，通过`add_error`方法给指定的field添加错误消息。</font></li><li><font style="font-size: 16pt;">直接抛出一个`raise ValidationError(message, code=&quot;属性名&quot;)`就可以了。</font></li></ul><ul><li><font style="font-size: 16pt;">重写`clean`方法会在先完成`django`默认的验证后，再重新执行`clean`方法的验证</font></li><li><font style="font-size: 16pt;">如果验证完成成功了，则直接返回当前值</font></li></ul></div><div><font style="font-size: 16pt;"><br/></font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">    def clean_password(self):</font></span></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">        password = self.cleaned_data.get('password',None)</font></span></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">        if len(password) &lt; 6:</font></span></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">            raise forms.ValidationError(u'password at least 6 length',code='min_length')</font></span></div><div><span style="font-family: Monaco; color: rgb(51, 51, 51);"><font style="font-size: 16pt;">        return password</font></span></div></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;"><br/></font></div><div><font style="font-size: 16pt;">作业： 完成一个注册页面，允许提交一个头像， 并有相对应的验证</font></div></div></span>
</div></body></html> 